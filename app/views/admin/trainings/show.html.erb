
<section class="admin-hero banner-dashboard"
  style="background-image: linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.55)), url('<%= banner_image_training_url(@training).presence || asset_path("banner_mcnc.jpeg") %>');">
  <div class="container py-5">
    <h1 class="display-5 fw-bold mb-1"><%= @training.name %></h1>

    <%# Méta (affichage conditionnel selon champs existants) %>
    <% if @training.respond_to?(:starts_at) || @training.respond_to?(:date) || @training.respond_to?(:location) %>
      <p class="lead mb-0">
        <% if @training.respond_to?(:starts_at) && @training.starts_at.present? %>
          <i class="far fa-clock me-1"></i> <%= l(@training.starts_at, format: :long) %>
          <% if @training.respond_to?(:ends_at) && @training.ends_at.present? %>
            — <%= l(@training.ends_at, format: :time) %>
          <% end %>
        <% elsif @training.respond_to?(:date) && @training.date.present? %>
          <i class="far fa-calendar-alt me-1"></i> <%= l(@training.date, format: "%d %B %Y") %>
        <% end %>

        <% if @training.respond_to?(:location) && @training.location.present? %>
          <span class="ms-3"><i class="fas fa-map-marker-alt me-1"></i> <%= @training.location %></span>
        <% end %>
      </p>
    <% end %>
  </div>
</section>

<section class="container my-5">
  <!-- Barre d’actions -->
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
    <h2 class="section-title mb-0">
      <i class="fa-solid fa-list-check"></i> Détail de l’entraînement
    </h2>

      <%= link_to edit_admin_training_path(@training), class: "btn-nxr d-inline-flex align-items-center" do %>
        <i class="fas fa-edit me-2"></i> Modifier la fiche 
      <% end %>
    </div>
  </div>

  <div class="row g-4">
    <!-- Colonne gauche : méta entraînement -->
    <div class="col-lg-4">
      <article class="card card-admin shadow-sm rounded-4 h-100">
        <div class="card-body small">
          <h3 class="h6 fw-bold mb-3"><i class="fa-solid fa-circle-info me-2"></i>Informations</h3>

          <div class="vstack gap-2">
            <% if @training.respond_to?(:level) && @training.level.present? %>
              <div><strong>Niveau :</strong> <%= @training.level %></div>
            <% end %>

            <% if @training.respond_to?(:capacity) && @training.capacity.present? %>
              <div><strong>Capacité :</strong> <%= @training.capacity %></div>
            <% end %>

            <% if @training.respond_to?(:coach) && @training.coach.present? %>
              <div><strong>Coach :</strong> <%= @training.coach %></div>
            <% end %>

            <% if @training.respond_to?(:price) && @training.price.present? %>
              <div><strong>Tarif :</strong> <%= number_to_currency(@training.price, unit: "€", format: "%n %u") %></div>
            <% end %>

            <% if @training.respond_to?(:status) && @training.status.present? %>
              <% status_badge =
                   case @training.status.to_s
                   when "published","open" then "badge-validated"
                   when "closed","archived" then "badge-rejected"
                   else "badge-pending"
                   end %>
              <div><strong>Statut :</strong> <span class="badge rounded-pill <%= status_badge %>"><%= @training.status.to_s.humanize %></span></div>
            <% end %>
          </div>
        </div>
      </article>
    </div>

    <!-- Colonne droite : description + inscriptions -->
    <div class="col-lg-8">
      <!-- Description -->
      <article class="card card-admin shadow-sm rounded-4 mb-4">
        <div class="card-body">
          <h3 class="h6 fw-bold mb-3"><i class="far fa-file-alt me-2"></i>Description</h3>
          <div>
            <%= simple_format(@training.description.presence || "Aucune description fournie.") %>
          </div>
        </div>
      </article>

      <!-- Inscriptions -->
      <article class="card card-admin shadow-sm rounded-4">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h3 class="h6 fw-bold mb-0"><i class="fas fa-user-plus me-2"></i>Inscriptions</h3>
            <% count = @training.registrations.size %>
            <span class="badge rounded-pill"><%= count %></span>
          </div>

          <% if @training.registrations.empty? %>
            <div class="text-center py-4">
              <i class="far fa-clipboard fa-2x mb-2"></i>
              <p class="mb-0">Aucune inscription pour le moment.</p>
            </div>
          <% else %>
            <div class="row g-3">
              <% @training.registrations.each do |registration| %>
                <% user = registration.user %>
                <div class="col-md-6 col-xl-4">
                  <article class="card shadow-sm rounded-4 h-100">
                    <div class="card-body d-flex align-items-center gap-3 position-relative">
                      <% if user.respond_to?(:avatar) && user.avatar.attached? %>
                        <%= image_tag user.avatar, class: "rounded-circle", width: 40, height: 40, alt: "#{user.first_name} #{user.last_name}", style: "object-fit:cover;" %>
                      <% else %>
                        <%= image_tag "avatar_default.jpg", class: "rounded-circle", width: 40, height: 40, alt: "#{user.first_name} #{user.last_name}", style: "object-fit:contain;background:rgba(0,0,0,.05);" %>
                      <% end %>

                      <div class="flex-grow-1">
                        <div class="fw-bold small"><%= user.first_name %> <%= user.last_name %></div>
                        <div class="text-muted tiny">
                          <i class="far fa-clock me-1"></i>
                          <%= l(registration.created_at, format: :short) %>
                        </div>
                      </div>

                      <%= link_to polymorphic_path([:admin, registration.registerable, registration]),
                                  class: "stretched-link text-decoration-none text-color-primary small" do %>
                        <i class="fas fa-arrow-right"></i>
                      <% end %>
                    </div>
                  </article>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </article>
    </div>
  </div>
</section>
