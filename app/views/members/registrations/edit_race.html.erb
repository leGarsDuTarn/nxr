<%# app/views/members/registrations/edit_race.html.erb %>

<%# ----- Banner (avec/sans image) ----- %>
<% if @registration.registerable.respond_to?(:image) && @registration.registerable.image.attached? %>
  <section class="banner-dashboard"
    style="background-image: linear-gradient(rgba(0,0,0,.45), rgba(0,0,0,.55)), url('<%= banner_image_url(@registration.registerable) %>');">
    <div class="container py-5 text-center">
      <h1 class="display-5 fw-bold mb-0"><%= @registration.registerable.name %></h1>
      <% if @registration.registerable.respond_to?(:date) && @registration.registerable.date.present? %>
        <div class="fw-bold mt-2 text-on-surface">
          <i class="far fa-calendar-alt me-1"></i>
          <%= l(@registration.registerable.date, format: "%d %B %Y") %>
        </div>
      <% end %>
    </div>
  </section>
<% else %>
  <section class="profile-user banner-dashboard">
    <div class="container py-5 text-center">
      <h1 class="display-5 fw-bold mb-0"><%= @registration.registerable.name %></h1>
      <% if @registration.registerable.respond_to?(:date) && @registration.registerable.date.present? %>
        <div class="fw-bold mt-2 text-on-surface">
          <i class="far fa-calendar-alt me-1"></i>
          <%= l(@registration.registerable.date, format: "%d %B %Y") %>
        </div>
      <% end %>
    </div>
  </section>
<% end %>

<div class="container d-flex justify-content-center align-items-start py-5">
  <div class="card-signup shadow p-4 p-md-5 rounded-4 w-100">
    <div class="d-flex justify-content-center mb-4">
      <h2 class="text-center">
        <strong>Modifier mon inscription</strong>
      </h2>
    </div>

    <%= simple_form_for @registration,
          url: polymorphic_path([:members, @registration.registerable, @registration]) do |f| %>
      <%= f.error_notification message: "Veuillez corriger les erreurs ci-dessous." %>

      <%# Identité — lecture seule %>
      <fieldset class="form-section mb-4">
        <legend class="section-title">Identité</legend>
        <div class="row g-3">
          <div class="col-md-6"><%= f.input :first_name,  label: "Prénom",            input_html: { value: @registration.user.first_name,  readonly: true } %></div>
          <div class="col-md-6"><%= f.input :last_name,   label: "Nom",               input_html: { value: @registration.user.last_name,   readonly: true } %></div>
          <div class="col-md-6"><%= f.input :birth_date,  label: "Date de naissance", input_html: { value: @registration.user.birth_date,  readonly: true } %></div>
          <div class="col-md-6"><%= f.input :phone_number,label: "Téléphone",         input_html: { value: @registration.user.phone_number,readonly: true } %></div>
          <div class="col-12"><%= f.input :address,       label: "Adresse",           input_html: { value: @registration.user.address,     readonly: true } %></div>
          <div class="col-md-4"><%= f.input :post_code,   label: "Code postal",       input_html: { value: @registration.user.post_code,   readonly: true } %></div>
          <div class="col-md-8"><%= f.input :town,        label: "Ville",             input_html: { value: @registration.user.town,        readonly: true } %></div>
        </div>
        <p class="small mt-2 mb-0">
          Vos informations d’identité sont préremplies à partir des données enregistrées dans votre profil.
        </p>
        <p class="small mt-2 mb-0">
          Besoin de modifier ces informations ?
          <%= link_to "mettez à jour votre profil", edit_user_registration_path, class: "badge-success-full-sm text-decoration-none" %>
        </p>
      </fieldset>

      <%# Informations course — lecture seule (sauf N° de course selon ton choix) %>
      <fieldset class="form-section mb-4">
        <legend class="section-title">Informations course</legend>
        <div class="row g-3">
          <div class="col-md-4"><%= f.input :license_code,   label: "Code licence", input_html: { value: @registration.user.license_code,   readonly: true } %></div>
          <div class="col-md-4"><%= f.input :license_number, label: "N° licence",   input_html: { value: @registration.user.license_number, readonly: true } %></div>
          <div class="col-md-4"><%= f.input :club_name,      label: "Club",         input_html: { value: @registration.user.club_name,      readonly: true } %></div>
          <div class="col-md-6">
            <%= f.input :race_number, label: "Numéro de course", placeholder: "Ex. 27", required: true %>
          </div>
        </div>
      </fieldset>

      <%# Véhicule — modifiable %>
      <fieldset class="form-section mb-4">
        <legend class="section-title">Informations véhicule</legend>
        <div class="row g-3">
          <div class="col-md-4">
            <%= f.input :bike_brand, as: :select, required: true,
                  collection: Registration::VALID_BRANDS,
                  label: "Marque de moto", prompt: "Sélectionner une marque" %>
          </div>
          <div class="col-md-4">
            <%= f.input :cylinder_capacity, as: :select, required: true,
                  collection: Registration::BIKE_CYLINDER_CAPACITY,
                  label: "Cylindrée (cc)", prompt: "Sélectionner la cylindrée" %>
          </div>
          <div class="col-md-4">
            <%= f.input :stroke_type, as: :select,
                  collection: [['2 temps', 'two_stroke'], ['4 temps', 'four_stroke']],
                  label: "Type de moteur", prompt: "Sélectionner le type" %>
          </div>
        </div>
      </fieldset>

      <%= f.hidden_field :registerable_id %>
      <%= f.hidden_field :registerable_type %>

      <div class="d-flex gap-2">
        <%= f.button :submit, "Enregistrer", class: "btn-nxr" %>
        <%= link_to "Annuler",
              polymorphic_path([:members, @registration.registerable, @registration]),
              class: "btn-nxr-orange" %>
      </div>
    <% end %>
  </div>
</div>
