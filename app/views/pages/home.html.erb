<!-- Banner -->
<div class="banner-hp"
     style="background-image: linear-gradient(rgba(0,0,0,0.40), rgba(0,0,0,0.40)), url(<%= asset_path('banner_mcnc.jpeg') %>);">
  <div class="container text-start home-hero">
    <h1 class="mb-2">Rejoignez le <strong>club</strong> MCNC</h1>
    <p class="mb-3">L'aventure commence ici ...</p>
    <div class="mt-4 d-flex gap-3 justify-content-start flex-wrap">
      <%= link_to "Créer un compte", new_user_registration_path, class: "btn-nxr" %>
      <%= link_to "En savoir plus", new_user_session_path, class: "btn-nxr-orange" %>
    </div>
  </div>
</div>

<!-- Événements à venir -->
<section class="container my-5 home-section">
  <h2 class="mb-4 text-start fs-1 fw-bold text-uppercase">
    <i class="fa-regular fa-calendar-days me-2"></i> Les événements à venir
  </h2>

  <% if @upcoming_activities.present? %>
    <div class="home-carousel" data-controller="home-carousel" data-home-carousel-step-value="item">
      <button type="button" class="home-carousel__nav home-carousel__nav--prev"
              data-action="click->home-carousel#prev" aria-label="Précédent">‹</button>
      <button type="button" class="home-carousel__nav home-carousel__nav--next"
              data-action="click->home-carousel#next" aria-label="Suivant">›</button>

      <div class="home-carousel__track" data-home-carousel-target="track">
        <% @upcoming_activities.each do |activity| %>
          <div class="home-carousel__item">
            <article class="card card-admin shadow-sm rounded-4 h-100 overflow-hidden">

              <!-- Image top -->
              <div class="ratio ratio-4x3 bg-dark">
                <% if activity.respond_to?(:image) && activity.image.attached? %>
                  <%= image_tag activity.image,
                        class: "card-img-top object-cover",
                        alt: activity.name %>
                <% else %>
                  <% default_image =
                    case activity.type
                    when "Race"     then "race_flag.png"
                    when "Training" then "training_img.png"
                    when "Event"    then "logo_mcnc_3.png"
                    else "logo_mcnc_3.png"
                    end %>
                  <%= image_tag default_image,
                        class: "card-img-top object-contain p-3",
                        alt: activity.name %>
                <% end %>
              </div>

              <!-- Body -->
              <div class="card-body d-flex flex-column">
                <h3 class="h6 fw-bold mb-2"><%= activity.name %></h3>

                <% if activity.respond_to?(:date) && activity.date.present? %>
                  <p class="text-tertiary small mb-2">
                    <i class="far fa-calendar-alt me-1"></i>
                    <%= l(activity.date, format: :long) %>
                  </p>
                <% end %>

                <div class="mt-auto pt-2">
                  <% if user_signed_in? && current_user.member?%>
                    <% view_path =
                        case activity.type
                        when "Race"     then members_race_path(activity.id)
                        when "Event"    then members_event_path(activity.id)
                        when "Training" then members_training_path(activity.id)
                        end %>
                  <%= link_to view_path,
                        class: "btn-nxr d-inline-flex align-items-center gap-2 small",
                        aria: { label: "En savoir plus sur « #{activity.name} »" } do %>
                      <i class="fa-solid fa-circle-info"></i>
                      <span>En savoir +</span>
                  <% end %>

                  <% else %>
                      <% view_path =
                      case activity.type
                      when "Race"     then public_race_path(activity.id)
                      when "Event"    then public_event_path(activity.id)
                      when "Training" then public_training_path(activity.id)
                      end %>
                  <%= link_to view_path,
                        class: "btn-nxr d-inline-flex align-items-center gap-2 small",
                        aria: { label: "En savoir plus sur « #{activity.name} »" } do %>
                      <i class="fa-solid fa-circle-info"></i>
                      <span>En savoir +</span>
                  <% end %>
                <% end %>
                </div>
              </div>
            </article>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="card-homepage shadow-sm rounded-4 text-center p-5 mx-auto" style="max-width: 640px;">
      <div class="mb-3"><i class="fas fa-inbox fa-3x"></i></div>
      <p class="mb-0">Aucun événement à venir pour le moment.</p>
    </div>
  <% end %>
</section>

<!-- News -->
<section class="container my-5 home-section">
  <h2 class="mb-4 text-start fs-1 fw-bold text-uppercase">
    <i class="fa-regular fa-newspaper me-2"></i> Les News
  </h2>

  <% if @articles.present? %>
    <div class="home-carousel" data-controller="home-carousel" data-home-carousel-step-value="item">
      <button type="button" class="home-carousel__nav home-carousel__nav--prev"
              data-action="click->home-carousel#prev" aria-label="Précédent">‹</button>
      <button type="button" class="home-carousel__nav home-carousel__nav--next"
              data-action="click->home-carousel#next" aria-label="Suivant">›</button>

      <div class="home-carousel__track" data-home-carousel-target="track">
        <% @articles.each do |article| %>
          <div class="home-carousel__item">
            <article class="card card-admin shadow-sm rounded-4 h-100 overflow-hidden">

              <!-- Image top -->
              <div class="ratio ratio-4x3 bg-dark">
                <%= image_tag(article.image.attached? ? article.image : "default_article.jpeg",
                      class: "card-img-top object-cover",
                      alt: article.title) %>
              </div>

              <!-- Body -->
              <div class="card-body d-flex flex-column">
                <h3 class="h6 fw-bold mb-2"><%= article.title %></h3>
                <p class="text-tertiary small mb-2">
                  Publié le <%= l(article.created_at.to_date, format: :long) %>
                </p>

                <div class="mt-auto pt-2">
                  <%= link_to public_article_path(article),
                        class: "btn-nxr d-inline-flex align-items-center gap-2 small",
                        aria: { label: "Lire l’article « #{article.title} »" } do %>
                    <i class="fa-regular fa-newspaper"></i>
                    <span>Lire l’article</span>
                  <% end %>
                </div>
              </div>
            </article>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="card-homepage shadow-sm rounded-4 text-center p-5 mx-auto" style="max-width: 640px;">
      <div class="mb-3"><i class="fas fa-inbox fa-3x"></i></div>
      <p class="mb-0">Aucune actualité pour le moment.</p>
    </div>
  <% end %>
</section>

<!-- Albums Photos -->
<section class="container my-5 home-section">
  <h2 class="mb-4 text-start fs-1 fw-bold text-uppercase">
    <i class="fa-regular fa-images me-2"></i> Albums Photos
  </h2>

  <% if @galleries.present? %>
    <div class="home-carousel" data-controller="home-carousel" data-home-carousel-step-value="item">
      <button type="button" class="home-carousel__nav home-carousel__nav--prev"
              data-action="click->home-carousel#prev" aria-label="Précédent">‹</button>
      <button type="button" class="home-carousel__nav home-carousel__nav--next"
              data-action="click->home-carousel#next" aria-label="Suivant">›</button>

      <div class="home-carousel__track" data-home-carousel-target="track">
        <% @galleries.each do |gallery| %>
          <div class="home-carousel__item">
            <article class="card card-admin shadow-sm rounded-4 h-100 overflow-hidden position-relative">
              <!-- Image top -->
              <div class="ratio ratio-4x3 bg-dark">
                <% if gallery.images.attached? %>
                  <%= image_tag gallery.images.first, class: "card-img-top object-cover", alt: gallery.title %>
                <% else %>
                  <%= image_tag "logo_mcnc_3.png", class: "card-img-top object-contain p-3", alt: gallery.title %>
                <% end %>
              </div>

              <!-- Body + bouton -->
              <div class="card-body d-flex flex-column">
                <h3 class="h6 fw-bold mb-2"><%= gallery.title %></h3>
                <p class="text-tertiary small mb-2">
                  Publié le <%= l(gallery.created_at.to_date, format: :long) %>
                </p>

                <div class="mt-auto pt-2">
                  <%= link_to public_gallery_path(gallery),
                      class: "btn-nxr d-inline-flex align-items-center gap-2 small",
                      aria: { label: "Voir la galerie « #{gallery.title} »" } do %>
                    <i class="fa-regular fa-images"></i>
                    <span>Voir la galerie</span>
                  <% end %>
                </div>

                <%# Lien étendu optionnel : rend toute la carte cliquable (laisser commenté si tu gardes le bouton)
                <%#= link_to "", public_gallery_path(gallery), class: "stretched-link" %>
              </div>
            </article>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="card-homepage shadow-sm rounded-4 text-center p-5 mx-auto" style="max-width: 640px;">
      <div class="mb-3"><i class="fas fa-inbox fa-3x"></i></div>
      <p class="mb-0">Aucune photo pour le moment.</p>
    </div>
  <% end %>
</section>
